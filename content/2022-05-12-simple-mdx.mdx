---
title: Simple MDX
tags: [software-engineering]
js: [https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js]
---

import { TwitterTweetEmbed } from 'https://esm.sh/react-twitter-embed';
import { Mermaid } from '/dist/components/Mermaid.js';

So you want to deploy a site that uses `MDX`? Outside of using [Nextjs](https://nextjs.org/docs/advanced-features/using-mdx), the process is much more difficult than it aught to be.

<center>
  <TwitterTweetEmbed tweetId={'1524057494829547521'} />
</center>

Technically we don't even need to mess with `mdx-bundler` (see [Building Without Bundling](./2022-05-12-skipping-the-bundling)). Going the "bundle-free" route, we can drop down and use [`@mdx-js/mdx`](https://github.com/mdx-js/mdx) directly. To me, bundle-free makes sense for `MDX` given each `MDX` page will likely be a small scale project.

> It will be interesting to see the days where we're developing entirely within documents and interlinking dozens or hundreds of docs via their exports. Where the prose is the first class citizen and the code the second. The confluence of [Notion](https://www.notion.so/)/[ObservableHQ](https://observablehq.com/)/[Jupyter](https://jupyter.org/)/[Quarto](https://quarto.org/)/[MDX](https://mdxjs.com/)/[CraftDocs](https://www.craft.do/)/[Coda](https://coda.io/)/[Obsidian](https://obsidian.md/)/[Airtable](https://www.airtable.com/) like features being brought together into a single authoring and coding paltform.

## Using MDX

Lets get started using `@mdx-js/mdx` directly. We'll go over a few things:

1. Ingesting MDX content for processing
2. Deciding what transformations to apply
3. Applying transforms and compiling the MDX to JavaScript
4. Loading the component on the frontend

### Ingesting Content

First step is to ingest your content. These can be files from disk or some other source of `MDX` content.

If they're files on disk you can read them easily via the `fs` api in `Node`/`Deno`.

```javascript
import { read } from 'to-vfile';

const files = await fs.promises.readdir(path);
await Promise.all(files.map(async (file) => processMdx(await read(file))));
```

[`to-vfile`](https://github.com/vfile/to-vfile) is a package that converts a file to [Unifiedjs](https://unifiedjs.com/)'s virtual file format for text processing. If you're reading files from the filesystem, its important to do this conversion to a vfile as some transformations rely on the metadata this conversion will bring (e.g., [unified-infer-git-meta](https://github.com/unifiedjs/unified-infer-git-meta)).

We'll fill in the details of `processMdx` when we cover compiling mdx to js.

### Picking transformations

`MDX` is based on `Remark`, `Rehype` and the `Unifiedjs` ecosystem.

The root of this ecosystem is a representation of text as a syntax tree ([hast](https://github.com/syntax-tree/hast)). All `unifiedjs` processors are built around this abstraction and work by applying transofrmations to the tree, passing the updated tree along to the next step in the processing pipeline so it can apply its transofrmations and then pass the updated tree to the next step and so on.

For more on pipelines in general, see [inheritance, aggregation and pipelines](/2013-07-30-Inheritance-Aggregation-and-Pipelines.html#pipelines)

A pipeline for converting `Markdown` to `html` might look something like:

<Mermaid id="example-pipe" chart={`
graph TD;
  remarkParse-->remarkFrontmatter
  remarkFrontmatter-->remarkGfm
  remarkGfm-->remarkWikiLink
  remarkWikiLink-->remarkRehype
  remarkRehype-->rehypeInferDescriptionMeta
  rehypeInferDescriptionMeta-->rehypeStringify
`} />
